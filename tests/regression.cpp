#include "regression.h"
#include "test_helpers.h"

using namespace velox;

TEST_CASE("regression 1") {
  // R: faithful
  const std::vector<Point> points{Point{79, 3.600},
                                  Point{54, 1.800},
                                  Point{74, 3.333},
                                  Point{62, 2.283},
                                  Point{85, 4.533},
                                  Point{55, 2.883},
                                  Point{88, 4.700},
                                  Point{85, 3.600},
                                  Point{51, 1.950},
                                  Point{85, 4.350},
                                  Point{54, 1.833},
                                  Point{84, 3.917},
                                  Point{78, 4.200},
                                  Point{47, 1.750},
                                  Point{83, 4.700},
                                  Point{52, 2.167},
                                  Point{62, 1.750},
                                  Point{84, 4.800},
                                  Point{52, 1.600},
                                  Point{79, 4.250},
                                  Point{51, 1.800},
                                  Point{47, 1.750},
                                  Point{78, 3.450},
                                  Point{69, 3.067},
                                  Point{74, 4.533},
                                  Point{83, 3.600},
                                  Point{55, 1.967},
                                  Point{76, 4.083},
                                  Point{78, 3.850},
                                  Point{79, 4.433},
                                  Point{73, 4.300},
                                  Point{77, 4.467},
                                  Point{66, 3.367},
                                  Point{80, 4.033},
                                  Point{74, 3.833},
                                  Point{52, 2.017},
                                  Point{48, 1.867},
                                  Point{80, 4.833},
                                  Point{59, 1.833},
                                  Point{90, 4.783},
                                  Point{80, 4.350},
                                  Point{58, 1.883},
                                  Point{84, 4.567},
                                  Point{58, 1.750},
                                  Point{73, 4.533},
                                  Point{83, 3.317},
                                  Point{64, 3.833},
                                  Point{53, 2.100},
                                  Point{82, 4.633},
                                  Point{59, 2.000},
                                  Point{75, 4.800},
                                  Point{90, 4.716},
                                  Point{54, 1.833},
                                  Point{80, 4.833},
                                  Point{54, 1.733},
                                  Point{83, 4.883},
                                  Point{71, 3.717},
                                  Point{64, 1.667},
                                  Point{77, 4.567},
                                  Point{81, 4.317},
                                  Point{59, 2.233},
                                  Point{84, 4.500},
                                  Point{48, 1.750},
                                  Point{82, 4.800},
                                  Point{60, 1.817},
                                  Point{92, 4.400},
                                  Point{78, 4.167},
                                  Point{78, 4.700},
                                  Point{65, 2.067},
                                  Point{73, 4.700},
                                  Point{82, 4.033},
                                  Point{56, 1.967},
                                  Point{79, 4.500},
                                  Point{71, 4.000},
                                  Point{62, 1.983},
                                  Point{76, 5.067},
                                  Point{60, 2.017},
                                  Point{78, 4.567},
                                  Point{76, 3.883},
                                  Point{83, 3.600},
                                  Point{75, 4.133},
                                  Point{82, 4.333},
                                  Point{70, 4.100},
                                  Point{65, 2.633},
                                  Point{73, 4.067},
                                  Point{88, 4.933},
                                  Point{76, 3.950},
                                  Point{80, 4.517},
                                  Point{48, 2.167},
                                  Point{86, 4.000},
                                  Point{60, 2.200},
                                  Point{90, 4.333},
                                  Point{50, 1.867},
                                  Point{78, 4.817},
                                  Point{63, 1.833},
                                  Point{72, 4.300},
                                  Point{84, 4.667},
                                  Point{75, 3.750},
                                  Point{51, 1.867},
                                  Point{82, 4.900},
                                  Point{62, 2.483},
                                  Point{88, 4.367},
                                  Point{49, 2.100},
                                  Point{83, 4.500},
                                  Point{81, 4.050},
                                  Point{47, 1.867},
                                  Point{84, 4.700},
                                  Point{52, 1.783},
                                  Point{86, 4.850},
                                  Point{81, 3.683},
                                  Point{75, 4.733},
                                  Point{59, 2.300},
                                  Point{89, 4.900},
                                  Point{79, 4.417},
                                  Point{59, 1.700},
                                  Point{81, 4.633},
                                  Point{50, 2.317},
                                  Point{85, 4.600},
                                  Point{59, 1.817},
                                  Point{87, 4.417},
                                  Point{53, 2.617},
                                  Point{69, 4.067},
                                  Point{77, 4.250},
                                  Point{56, 1.967},
                                  Point{88, 4.600},
                                  Point{81, 3.767},
                                  Point{45, 1.917},
                                  Point{82, 4.500},
                                  Point{55, 2.267},
                                  Point{90, 4.650},
                                  Point{45, 1.867},
                                  Point{83, 4.167},
                                  Point{56, 2.800},
                                  Point{89, 4.333},
                                  Point{46, 1.833},
                                  Point{82, 4.383},
                                  Point{51, 1.883},
                                  Point{86, 4.933},
                                  Point{53, 2.033},
                                  Point{79, 3.733},
                                  Point{81, 4.233},
                                  Point{60, 2.233},
                                  Point{82, 4.533},
                                  Point{77, 4.817},
                                  Point{76, 4.333},
                                  Point{59, 1.983},
                                  Point{80, 4.633},
                                  Point{49, 2.017},
                                  Point{96, 5.100},
                                  Point{53, 1.800},
                                  Point{77, 5.033},
                                  Point{77, 4.000},
                                  Point{65, 2.400},
                                  Point{81, 4.600},
                                  Point{71, 3.567},
                                  Point{70, 4.000},
                                  Point{81, 4.500},
                                  Point{93, 4.083},
                                  Point{53, 1.800},
                                  Point{89, 3.967},
                                  Point{45, 2.200},
                                  Point{86, 4.150},
                                  Point{58, 2.000},
                                  Point{78, 3.833},
                                  Point{66, 3.500},
                                  Point{76, 4.583},
                                  Point{63, 2.367},
                                  Point{88, 5.000},
                                  Point{52, 1.933},
                                  Point{93, 4.617},
                                  Point{49, 1.917},
                                  Point{57, 2.083},
                                  Point{77, 4.583},
                                  Point{68, 3.333},
                                  Point{81, 4.167},
                                  Point{81, 4.333},
                                  Point{73, 4.500},
                                  Point{50, 2.417},
                                  Point{85, 4.000},
                                  Point{74, 4.167},
                                  Point{55, 1.883},
                                  Point{77, 4.583},
                                  Point{83, 4.250},
                                  Point{83, 3.767},
                                  Point{51, 2.033},
                                  Point{78, 4.433},
                                  Point{84, 4.083},
                                  Point{46, 1.833},
                                  Point{83, 4.417},
                                  Point{55, 2.183},
                                  Point{81, 4.800},
                                  Point{57, 1.833},
                                  Point{76, 4.800},
                                  Point{84, 4.100},
                                  Point{77, 3.966},
                                  Point{81, 4.233},
                                  Point{87, 3.500},
                                  Point{77, 4.366},
                                  Point{51, 2.250},
                                  Point{78, 4.667},
                                  Point{60, 2.100},
                                  Point{82, 4.350},
                                  Point{91, 4.133},
                                  Point{53, 1.867},
                                  Point{78, 4.600},
                                  Point{46, 1.783},
                                  Point{77, 4.367},
                                  Point{84, 3.850},
                                  Point{49, 1.933},
                                  Point{83, 4.500},
                                  Point{71, 2.383},
                                  Point{80, 4.700},
                                  Point{49, 1.867},
                                  Point{75, 3.833},
                                  Point{64, 3.417},
                                  Point{76, 4.233},
                                  Point{53, 2.400},
                                  Point{94, 4.800},
                                  Point{55, 2.000},
                                  Point{76, 4.150},
                                  Point{50, 1.867},
                                  Point{82, 4.267},
                                  Point{54, 1.750},
                                  Point{75, 4.483},
                                  Point{78, 4.000},
                                  Point{79, 4.117},
                                  Point{78, 4.083},
                                  Point{78, 4.267},
                                  Point{70, 3.917},
                                  Point{79, 4.550},
                                  Point{70, 4.083},
                                  Point{54, 2.417},
                                  Point{86, 4.183},
                                  Point{50, 2.217},
                                  Point{90, 4.450},
                                  Point{54, 1.883},
                                  Point{54, 1.850},
                                  Point{77, 4.283},
                                  Point{79, 3.950},
                                  Point{64, 2.333},
                                  Point{75, 4.150},
                                  Point{47, 2.350},
                                  Point{86, 4.933},
                                  Point{63, 2.900},
                                  Point{85, 4.583},
                                  Point{82, 3.833},
                                  Point{57, 2.083},
                                  Point{82, 4.367},
                                  Point{67, 2.133},
                                  Point{74, 4.350},
                                  Point{54, 2.200},
                                  Point{83, 4.450},
                                  Point{73, 3.567},
                                  Point{73, 4.500},
                                  Point{88, 4.150},
                                  Point{80, 3.817},
                                  Point{71, 3.917},
                                  Point{83, 4.450},
                                  Point{56, 2.000},
                                  Point{79, 4.283},
                                  Point{78, 4.767},
                                  Point{84, 4.533},
                                  Point{58, 1.850},
                                  Point{83, 4.250},
                                  Point{43, 1.983},
                                  Point{60, 2.250},
                                  Point{75, 4.750},
                                  Point{81, 4.117},
                                  Point{46, 2.150},
                                  Point{90, 4.417},
                                  Point{46, 1.817},
                                  Point{74, 4.467}};

  const auto sl = slope(points);
  const auto r2 = r_squared(points, sl);

  REQUIRE(0.05012 == Approx(sl));
  REQUIRE(0.9726 == Approx(r2));
}

TEST_CASE("regression 2") {
  const std::vector<Point> points{
      Point{2, 2.21444}, Point{3, 3.31424}, Point{4, 4.4513}, Point{5, 5.45477}, Point{6, 6.57193}};

  const auto sl = slope(points);
  const auto r2 = r_squared(points, sl);

  REQUIRE(1.09869 == Approx(sl));
  REQUIRE(0.99994 == Approx(r2));
}

TEST_CASE("regression 3") {
  const std::vector<Point> points{Point{964, 1.96378},
                                  Point{1446, 2.93869},
                                  Point{1928, 3.91952},
                                  Point{2410, 5.12641},
                                  Point{2892, 5.94297}};

  const auto sl = slope(points);
  const auto r2 = r_squared(points, sl);

  REQUIRE(0.002068 == Approx(sl));
  REQUIRE(0.99966 == Approx(r2));
}
